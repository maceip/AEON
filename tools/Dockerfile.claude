# Dockerfile.claude - Build riscv64 Alpine rootfs with Node.js + Claude Code
#
# Usage:
#   docker buildx build --platform linux/riscv64 -f tools/Dockerfile.claude -t friscy-claude . --load
#   docker create --name tmp friscy-claude
#   docker export tmp > friscy-bundle/rootfs.tar
#   docker rm tmp

FROM --platform=linux/riscv64 alpine:edge

# Install Node.js, npm, and essential engineering tools
RUN apk add --no-cache \
    nodejs \
    npm \
    curl \
    bash \
    git \
    ripgrep \
    python3 \
    py3-pip \
    ca-certificates \
    nano \
    gnupg

# Install uv (Fast Python package manager)
# Note: Check for riscv64 binary availability, else fallback to pip or script
RUN curl -LsSf https://astral.sh/uv/install.sh | sh && \
    ln -s /root/.local/bin/uv /usr/local/bin/uv || \
    pip install uv --break-system-packages

# Install Claude Code globally via npm (pure JS, no native addons)
RUN npm install -g @anthropic-ai/claude-code

# Create shared mount point
RUN mkdir -p /mnt/host

# Default shell
CMD ["/bin/sh"]
